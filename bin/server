#!/usr/bin/env node
const http = require('http');

const src = require('../src');
const globals = require('../src/globals');
const fileWatcher = require('../src/handlers/file-watcher');
const appShutdown = require('../src/handlers/app_shutdown');

const eliteLogDirectory = process.argv[2] || process.env.EDD_LOG_DIR;

const logger = globals.getLogger();
const port = 8888;
const app = src.buildApp();

const server = http.Server(app);
const fileWatcherData = fileWatcher.wire(server);
fileWatcher.watchPath(eliteLogDirectory, fileWatcherData.socket);

appShutdown.wire(() => {
  fileWatcherData.shutdownHandler();
});

server.listen(port, () => logger.info(`Example app listening on port ${port}!`));
